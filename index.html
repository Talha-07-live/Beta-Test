<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aggressive Popup Blocker for Iframe</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        iframe {
            width: 100%;
            height: 500px;
            border: none;
        }
    </style>
</head>
<body>

    <h1>Video Embed with Popup Block (Aggressive)</h1>

    <!-- Iframe embedding without sandbox -->
    <iframe 
        id="myIframe" 
        src="https://stream.crichd.sc/update/willowcricket.php?autoplay=1" 
        allow="autoplay" 
        allowfullscreen></iframe>

    <script>
        // Prevent new windows/tabs by continuously monitoring and closing them
        let blockedWindows = [];

        // Overriding window.open globally to block popups
        (function() {
            const originalOpen = window.open;
            window.open = function(url, name, specs) {
                console.log('Attempt to open a new window/tab detected. Blocking:', url);
                return null;  // Block the new window or tab
            };
        })();

        // Monitor and close any new popups immediately after they are created
        const closeNewWindows = setInterval(function() {
            for (let i = 0; i < blockedWindows.length; i++) {
                if (!blockedWindows[i].closed) {
                    blockedWindows[i].close();
                    console.log('Closed a newly opened window.');
                }
            }
        }, 100);

        // Detect focus shift when a new window/tab is opened
        window.addEventListener('focus', function() {
            if (blockedWindows.length > 0) {
                blockedWindows.forEach(win => {
                    if (!win.closed) {
                        win.close();
                        console.log('Closed a popup window/tab after focus shift.');
                    }
                });
            }
        });

        // Add an event listener to iframe load to attempt blocking popup navigation
        document.getElementById('myIframe').addEventListener('load', function() {
            const iframe = document.getElementById('myIframe');
            const iframeWindow = iframe.contentWindow || iframe.contentDocument.defaultView;

            try {
                // Add click event listener to prevent link clicks from opening new windows
                iframeWindow.document.addEventListener('click', function(event) {
                    const target = event.target || event.srcElement;

                    // If a link is clicked, prevent its default behavior
                    if (target.tagName === 'A' || target.closest('A')) {
                        event.preventDefault();
                        console.log('Blocked a link click inside the iframe.');
                    }
                });
            } catch (e) {
                console.error('Error accessing iframe content due to cross-origin restrictions:', e);
            }
        });
    </script>

</body>
</html>
